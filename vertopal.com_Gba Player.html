<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>022d12e3e0f04c338f6b709e3b7aad06</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 49%" />
</colgroup>
<tbody>
<tr class="odd">
<td>&lt;!doctype html&gt;</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>&lt;html lang="en"&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>&lt;head&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;!-- Required meta tags --&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;meta charset="utf-8"&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;meta name="apple-mobile-web-app-capable" content="yes"&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;meta name="apple-mobile-web-app-status-bar-style"
content="black"&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;meta name="viewport" content="user-scalable=no, initial-scale=1,
maximum-scale=1, minimum-scale=1, width=device-width,
height=device-height"&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;link rel="apple-touch-icon" href="<a
href="https://44670.org/gba/icon.png"><u>icon.png</u></a>"&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;link rel="manifest" href="<a
href="https://44670.org/gba/manifest.json"><u>manifest.json</u></a>"&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;title&gt;vba-next-wasm&lt;/title&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>&lt;/head&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>&lt;body&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;style&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>a,</td>
</tr>
<tr class="odd">
<td></td>
<td>a:visited {</td>
</tr>
<tr class="even">
<td></td>
<td>color: white;</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>html,</td>
</tr>
<tr class="even">
<td></td>
<td>body {</td>
</tr>
<tr class="odd">
<td></td>
<td>position: fixed;</td>
</tr>
<tr class="even">
<td></td>
<td>overflow: hidden;</td>
</tr>
<tr class="odd">
<td></td>
<td>-webkit-user-select: none;</td>
</tr>
<tr class="even">
<td></td>
<td>user-select: none;</td>
</tr>
<tr class="odd">
<td></td>
<td>-webkit-touch-callout:none;</td>
</tr>
<tr class="even">
<td></td>
<td>touch-action: none;</td>
</tr>
<tr class="odd">
<td></td>
<td>cursor: inherit;</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>body {</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>background-color: #000000;</td>
</tr>
<tr class="odd">
<td></td>
<td>color: #FFFFFF;</td>
</tr>
<tr class="even">
<td></td>
<td>padding: 0;</td>
</tr>
<tr class="odd">
<td></td>
<td>margin: 0;</td>
</tr>
<tr class="even">
<td></td>
<td>width: 100vw;</td>
</tr>
<tr class="odd">
<td></td>
<td>height: 100vh;</td>
</tr>
<tr class="even">
<td></td>
<td>font-family: 'Myriad Set Pro','Helvetica
Neue',Helvetica,Arial,sans-serif;</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>hr {</td>
</tr>
<tr class="even">
<td></td>
<td>color: white;</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>button {</td>
</tr>
<tr class="even">
<td></td>
<td>border: 2px solid white;</td>
</tr>
<tr class="odd">
<td></td>
<td>background: transparent;</td>
</tr>
<tr class="even">
<td></td>
<td>color: white;</td>
</tr>
<tr class="odd">
<td></td>
<td>padding: .5em;</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>.vk-round {</td>
</tr>
<tr class="odd">
<td></td>
<td>text-align: center;</td>
</tr>
<tr class="even">
<td></td>
<td>vertical-align: middle;</td>
</tr>
<tr class="odd">
<td></td>
<td>border-radius: 50%;</td>
</tr>
<tr class="even">
<td></td>
<td>display: inline-block;</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>.vk {</td>
</tr>
<tr class="odd">
<td></td>
<td>color: rgba(0, 0, 0, 0.2);</td>
</tr>
<tr class="even">
<td></td>
<td>background-color: rgba(255, 255, 255, 0.25);</td>
</tr>
<tr class="odd">
<td></td>
<td>position: absolute;</td>
</tr>
<tr class="even">
<td></td>
<td>z-index: 1;</td>
</tr>
<tr class="odd">
<td></td>
<td>text-align: center;</td>
</tr>
<tr class="even">
<td></td>
<td>vertical-align: middle;</td>
</tr>
<tr class="odd">
<td></td>
<td>display: inline-block;</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>.vk-hide {</td>
</tr>
<tr class="odd">
<td></td>
<td>background-color: transparent !important</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>.vk-touched {</td>
</tr>
<tr class="odd">
<td></td>
<td>background-color: rgba(255, 255, 255, 0.75) !important</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>.menu {</td>
</tr>
<tr class="odd">
<td></td>
<td>background: rgb(32,43,56);</td>
</tr>
<tr class="even">
<td></td>
<td>position: absolute;</td>
</tr>
<tr class="odd">
<td></td>
<td>left: 0;</td>
</tr>
<tr class="even">
<td></td>
<td>top: 0;</td>
</tr>
<tr class="odd">
<td></td>
<td>width: 100vw;</td>
</tr>
<tr class="even">
<td></td>
<td>height: 100vh;</td>
</tr>
<tr class="odd">
<td></td>
<td>z-index: 999;</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>#gba-canvas {</td>
</tr>
<tr class="odd">
<td></td>
<td>position: absolute;</td>
</tr>
<tr class="even">
<td></td>
<td>z-index: -1;</td>
</tr>
<tr class="odd">
<td></td>
<td>image-rendering: pixelated;</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>#vk-layer {</td>
</tr>
<tr class="odd">
<td></td>
<td>position: absolute;</td>
</tr>
<tr class="even">
<td></td>
<td>left: 0;</td>
</tr>
<tr class="odd">
<td></td>
<td>top: 0;</td>
</tr>
<tr class="even">
<td></td>
<td>width: 100%;</td>
</tr>
<tr class="odd">
<td></td>
<td>height: 100%;</td>
</tr>
<tr class="even">
<td></td>
<td>z-index: 3;</td>
</tr>
<tr class="odd">
<td></td>
<td>touch-action: none;</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>#msg-layer {</td>
</tr>
<tr class="odd">
<td></td>
<td>position: absolute;</td>
</tr>
<tr class="even">
<td></td>
<td>left: 0;</td>
</tr>
<tr class="odd">
<td></td>
<td>width: 100%;</td>
</tr>
<tr class="even">
<td></td>
<td>top: 40vh;</td>
</tr>
<tr class="odd">
<td></td>
<td>background:rgba(0,0,0,0.5);</td>
</tr>
<tr class="even">
<td></td>
<td>z-index: 2;</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;/style&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;div id="pause-menu" class="menu" style="background:
rgba(32,43,56,0.7);" hidden&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;h1&gt;&lt;button onclick="setPauseMenu(false)"&gt; ‚Üê Back
&lt;/button&gt;Game Paused&lt;/h1&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;hr&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>Memory Hacking:&lt;br&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;input id="cht-addr" value="0x"&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;input id="cht-value"&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;button onclick="chtReadBtn()"&gt;Read&lt;/button&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;button onclick="chtWriteBtn()"&gt;Write&lt;/button&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;hr&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>Savegame management:&lt;br&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;button onclick="savBackupBtn()"&gt;Backup&lt;/button&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;input type="file" id="sav-file" /&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;button onclick="savRestoreBtn()"&gt;Restore&lt;/button&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;/div&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;div id="welcome" class="menu"&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;h2&gt;vba-next-wasm&lt;/h2&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;hr&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;div id="wasm-loading"&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>Loading WebAssembly, please wait...</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;/div&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;div id="select-rom" hidden&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;p&gt;choose your own file:&lt;br&gt;&lt;input
style="padding:.5em; border:2px solid white;" type="file"
id="romFile"</td>
</tr>
<tr class="odd">
<td></td>
<td>onchange="onFileSelected()" /&gt;&lt;/p&gt;</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;/div&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;hr&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>Deprecated! New version is available at:
&lt;b&gt;https://gba.44670.org/&lt;/b&gt; &lt;br&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>DS Player is also available at: https://ds.44670.org/&lt;br&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;br&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>&lt;p&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>This software should not be used to play games you have not legally
obtained.&lt;br&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>"GBA" is a trademark of Nintendo. This site is not associated with
Nintendo in any way.</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;/p&gt;</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>Ver. 20210114 | &lt;a target="_blank"</td>
</tr>
<tr class="even">
<td></td>
<td>href="<a
href="https://github.com/44670/vba-next-wasm"><u>https://github.com/44670/vba-next-wasm</u></a>"&gt;https://github.com/44670/vba-next-wasm&lt;/a&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;div id="ios-hint" hidden&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>Due to limitations of iOS, please &lt;b&gt;add this page to the home
screen&lt;/b&gt; and launch it from the home screen icon to enable
features including savegame and full screen.</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;p style="text-align: center;"&gt;üëá&lt;/p&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;/div&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;/div&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;div id="msg-layer" hidden&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;p id="msg-text"&gt;&lt;/p&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;/div&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;div id="vk-layer" hidden&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;div class="vk-rect vk" data-k="menu"&gt;Menu&lt;/div&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;div class="vk-rect vk" data-k="turbo"&gt;Turbo&lt;/div&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;div class="vk-rect vk" data-k="l"&gt;L&lt;/div&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;div class="vk-rect vk" data-k="r"&gt;R&lt;/div&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;div class="vk-round vk" data-k="a"&gt;A&lt;/div&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;div class="vk-round vk" data-k="b"&gt;B&lt;/div&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;div class="vk-rect vk"
data-k="select"&gt;Select&lt;/div&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;div class="vk-rect vk" data-k="start"&gt;Start&lt;/div&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;div class=" vk" data-k="left"&gt;‚Üê&lt;/div&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;div class=" vk" data-k="right"&gt;‚Üí&lt;/div&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;div class=" vk" data-k="up"&gt;‚Üë&lt;/div&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;div class=" vk" data-k="down"&gt;‚Üì&lt;/div&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;div class=" vk vk-hide" style="background-color: transparent
!important" data-k="ul"&gt;&lt;/div&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;div class=" vk vk-hide" style="background-color: transparent
!important" data-k="ur"&gt;&lt;/div&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;div class=" vk vk-hide" style="background-color: transparent
!important" data-k="dl"&gt;&lt;/div&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;div class=" vk vk-hide" style="background-color: transparent
!important" data-k="dr"&gt;&lt;/div&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;/div&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;canvas width="240" height="160" id="gba-canvas"
style="touch-action: none;image-rendering:
pixelated;"&gt;&lt;/canvas&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>&lt;script src="<a
href="https://44670.org/gba/localforage.js"><u>localforage.js</u></a>"&gt;&lt;/script&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;script&gt;</td>
</tr>
<tr class="even">
<td></td>
<td>alert("This software is deprecated.\nPlease use the new one
at:\nhttps://gba.44670.org");</td>
</tr>
<tr class="odd">
<td></td>
<td>if (!window.WebAssembly) {</td>
</tr>
<tr class="even">
<td></td>
<td>alert('Sorry, your browser does not support WebAssembly. :(')</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>window.onerror = function (msg, url, line, col, error) {</td>
</tr>
<tr class="even">
<td></td>
<td>var extra = !col ? '' : '\ncolumn: ' + col;</td>
</tr>
<tr class="odd">
<td></td>
<td>extra += !error ? '' : '\nerror: ' + error;</td>
</tr>
<tr class="even">
<td></td>
<td>alert("Error: " + msg + "\nurl: " + url + "\nline: " + line +
extra);</td>
</tr>
<tr class="odd">
<td></td>
<td>window.onerror = console.log</td>
</tr>
<tr class="even">
<td></td>
<td>debugger</td>
</tr>
<tr class="odd">
<td></td>
<td>return true;</td>
</tr>
<tr class="even">
<td></td>
<td>};</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>var isIOS = !!navigator.platform &amp;&amp;
/iPad|iPhone|iPod/.test(navigator.platform);</td>
</tr>
<tr class="odd">
<td></td>
<td>var isWebApp = navigator.standalone || false</td>
</tr>
<tr class="even">
<td></td>
<td>var isSaveSupported = true</td>
</tr>
<tr class="odd">
<td></td>
<td>if (isIOS) {</td>
</tr>
<tr class="even">
<td></td>
<td>//document.getElementById('romFile').files = null;</td>
</tr>
<tr class="odd">
<td></td>
<td>if (!isWebApp) {</td>
</tr>
<tr class="even">
<td></td>
<td>// On iOS Safari, the indexedDB will be cleared after 7 days.</td>
</tr>
<tr class="odd">
<td></td>
<td>// To prevent users from frustration, we don't allow savegaming on
iOS unless the we are in the PWA mode.</td>
</tr>
<tr class="even">
<td></td>
<td>isSaveSupported = false</td>
</tr>
<tr class="odd">
<td></td>
<td>alert('Due to limitations of iOS, please add this page to the home
screen and launch it from the home screen icon to enable features
including savegame and full screen.')</td>
</tr>
<tr class="even">
<td></td>
<td>var divIosHint = document.getElementById('ios-hint')</td>
</tr>
<tr class="odd">
<td></td>
<td>divIosHint.hidden = false</td>
</tr>
<tr class="even">
<td></td>
<td>divIosHint.style = 'position: absolute; bottom: '+
divIosHint.clientHeight + 'px;'</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>var keyState = {</td>
</tr>
<tr class="even">
<td></td>
<td>};</td>
</tr>
<tr class="odd">
<td></td>
<td>const keyList = ["a", "b", "select", "start", "right", "left", 'up',
'down', 'r', 'l'];</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>const AUDIO_BLOCK_SIZE = 1024</td>
</tr>
<tr class="even">
<td></td>
<td>const AUDIO_FIFO_MAXLEN = 4900</td>
</tr>
<tr class="odd">
<td></td>
<td>var audioContext</td>
</tr>
<tr class="even">
<td></td>
<td>var scriptProcessor</td>
</tr>
<tr class="odd">
<td></td>
<td>var audioFifo0 = new Int16Array(AUDIO_FIFO_MAXLEN)</td>
</tr>
<tr class="even">
<td></td>
<td>var audioFifo1 = new Int16Array(AUDIO_FIFO_MAXLEN)</td>
</tr>
<tr class="odd">
<td></td>
<td>var audioFifoHead = 0</td>
</tr>
<tr class="even">
<td></td>
<td>var audioFifoCnt = 0</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>var fileInput = document.getElementById('romFile')</td>
</tr>
<tr class="odd">
<td></td>
<td>var canvas = document.getElementById('gba-canvas')</td>
</tr>
<tr class="even">
<td></td>
<td>var drawContext = canvas.getContext('2d')</td>
</tr>
<tr class="odd">
<td></td>
<td>var romBuffer = -1</td>
</tr>
<tr class="even">
<td></td>
<td>var idata</td>
</tr>
<tr class="odd">
<td></td>
<td>var isRunning = false</td>
</tr>
<tr class="even">
<td></td>
<td>var isWasmReady = false</td>
</tr>
<tr class="odd">
<td></td>
<td>var wasmAudioBuf</td>
</tr>
<tr class="even">
<td></td>
<td>var wasmSaveBuf</td>
</tr>
<tr class="odd">
<td></td>
<td>const wasmSaveBufLen = 0x20000 + 0x2000</td>
</tr>
<tr class="even">
<td></td>
<td>var tmpSaveBuf = new Uint8Array(wasmSaveBufLen)</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>var frameCnt = 0</td>
</tr>
<tr class="odd">
<td></td>
<td>var last128FrameTime = 0</td>
</tr>
<tr class="even">
<td></td>
<td>var lastFrameTime = 0</td>
</tr>
<tr class="odd">
<td></td>
<td>var frameSkip = 0</td>
</tr>
<tr class="even">
<td></td>
<td>var lowLatencyMode = false</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>var lastCheckedSaveState = 0</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>var gameID</td>
</tr>
<tr class="odd">
<td></td>
<td>var romFileName</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>var turboMode = false</td>
</tr>
<tr class="even">
<td></td>
<td>var turboInterval = -1</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>var gbaWidth</td>
</tr>
<tr class="odd">
<td></td>
<td>var gbaHeight</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>function processAudio(event) {</td>
</tr>
<tr class="odd">
<td></td>
<td>var outputBuffer = event.outputBuffer</td>
</tr>
<tr class="even">
<td></td>
<td>var audioData0 = outputBuffer.getChannelData(0)</td>
</tr>
<tr class="odd">
<td></td>
<td>var audioData1 = outputBuffer.getChannelData(1)</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>if ((!isRunning) || (turboMode)) {</td>
</tr>
<tr class="even">
<td></td>
<td>for (var i = 0; i &lt; AUDIO_BLOCK_SIZE; i++) {</td>
</tr>
<tr class="odd">
<td></td>
<td>audioData0[i] = 0</td>
</tr>
<tr class="even">
<td></td>
<td>audioData1[i] = 0</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>return</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>while (audioFifoCnt &lt; AUDIO_BLOCK_SIZE) {</td>
</tr>
<tr class="odd">
<td></td>
<td>//console.log('audio fifo underflow, running a new frame')</td>
</tr>
<tr class="even">
<td></td>
<td>emuRunFrame();</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>var copySize = AUDIO_BLOCK_SIZE</td>
</tr>
<tr class="even">
<td></td>
<td>if (audioFifoCnt &lt; copySize) {</td>
</tr>
<tr class="odd">
<td></td>
<td>copySize = audioFifoCnt</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>for (var i = 0; i &lt; copySize; i++) {</td>
</tr>
<tr class="even">
<td></td>
<td>audioData0[i] = audioFifo0[audioFifoHead] / 32768.0</td>
</tr>
<tr class="odd">
<td></td>
<td>audioData1[i] = audioFifo1[audioFifoHead] / 32768.0</td>
</tr>
<tr class="even">
<td></td>
<td>audioFifoHead = (audioFifoHead + 1) % AUDIO_FIFO_MAXLEN</td>
</tr>
<tr class="odd">
<td></td>
<td>audioFifoCnt--</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>// must be called in user gesture</td>
</tr>
<tr class="even">
<td></td>
<td>function tryInitSound() {</td>
</tr>
<tr class="odd">
<td></td>
<td>if (audioContext) {</td>
</tr>
<tr class="even">
<td></td>
<td>if (audioContext.state != 'running') {</td>
</tr>
<tr class="odd">
<td></td>
<td>audioContext.resume()</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>return;</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>try {</td>
</tr>
<tr class="even">
<td></td>
<td>audioContext = new (window.AudioContext ||
window.webkitAudioContext)({ latencyHint: 0.0001, sampleRate: 48000
});</td>
</tr>
<tr class="odd">
<td></td>
<td>scriptProcessor =
audioContext.createScriptProcessor(AUDIO_BLOCK_SIZE, 0, 2)</td>
</tr>
<tr class="even">
<td></td>
<td>scriptProcessor.onaudioprocess = processAudio</td>
</tr>
<tr class="odd">
<td></td>
<td>scriptProcessor.connect(audioContext.destination)</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>audioContext.resume()</td>
</tr>
<tr class="even">
<td></td>
<td>} catch (e) {</td>
</tr>
<tr class="odd">
<td></td>
<td>console.log(e)</td>
</tr>
<tr class="even">
<td></td>
<td>//alert('Cannnot init sound ')</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>function writeAudio(ptr, frames) {</td>
</tr>
<tr class="odd">
<td></td>
<td>//console.log(ptr, frames)</td>
</tr>
<tr class="even">
<td></td>
<td>if (turboMode) {</td>
</tr>
<tr class="odd">
<td></td>
<td>return</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>if (!wasmAudioBuf) {</td>
</tr>
<tr class="even">
<td></td>
<td>wasmAudioBuf = new Int16Array(Module.HEAPU8.buffer).subarray(ptr /
2, ptr / 2 + 2048)</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>var tail = (audioFifoHead + audioFifoCnt) % AUDIO_FIFO_MAXLEN</td>
</tr>
<tr class="odd">
<td></td>
<td>if (audioFifoCnt + frames &gt;= AUDIO_FIFO_MAXLEN) {</td>
</tr>
<tr class="even">
<td></td>
<td>console.log('audio fifo overflow (wow)', audioFifoCnt)</td>
</tr>
<tr class="odd">
<td></td>
<td>return</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>for (var i = 0; i &lt; frames; i++) {</td>
</tr>
<tr class="even">
<td></td>
<td>audioFifo0[tail] = wasmAudioBuf[i * 2]</td>
</tr>
<tr class="odd">
<td></td>
<td>audioFifo1[tail] = wasmAudioBuf[i * 2 + 1]</td>
</tr>
<tr class="even">
<td></td>
<td>tail = (tail + 1) % AUDIO_FIFO_MAXLEN</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>audioFifoCnt += frames</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>function drawFrame(ptr) {</td>
</tr>
<tr class="even">
<td></td>
<td>//console.log(ptr)</td>
</tr>
<tr class="odd">
<td></td>
<td>if (!idata) {</td>
</tr>
<tr class="even">
<td></td>
<td>// assuming ptr is always same</td>
</tr>
<tr class="odd">
<td></td>
<td>idata = new ImageData(new
Uint8ClampedArray(Module.HEAPU8.buffer).subarray(ptr, ptr + 240 * 160 *
4), 240, 160)</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>drawContext.putImageData(idata, 0, 0)</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>function wasmReady() {</td>
</tr>
<tr class="odd">
<td></td>
<td>romBuffer = Module._getBuffer(1)</td>
</tr>
<tr class="even">
<td></td>
<td>var ptr = Module._getBuffer(0)</td>
</tr>
<tr class="odd">
<td></td>
<td>wasmSaveBuf = Module.HEAPU8.subarray(ptr, ptr + wasmSaveBufLen)</td>
</tr>
<tr class="even">
<td></td>
<td>isWasmReady = true</td>
</tr>
<tr class="odd">
<td></td>
<td>document.getElementById('wasm-loading').hidden = true</td>
</tr>
<tr class="even">
<td></td>
<td>document.getElementById('select-rom').hidden = false</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>function loadSaveGame(index, cb) {</td>
</tr>
<tr class="odd">
<td></td>
<td>console.log('load', gameID, index)</td>
</tr>
<tr class="even">
<td></td>
<td>localforage.getItem(gameID + '-save-' + index, function (err, data)
{</td>
</tr>
<tr class="odd">
<td></td>
<td>//console.log(err, data)</td>
</tr>
<tr class="even">
<td></td>
<td>if (data) {</td>
</tr>
<tr class="odd">
<td></td>
<td>wasmSaveBuf.set(data)</td>
</tr>
<tr class="even">
<td></td>
<td>clearSaveBufState()</td>
</tr>
<tr class="odd">
<td></td>
<td>cb(true)</td>
</tr>
<tr class="even">
<td></td>
<td>} else {</td>
</tr>
<tr class="odd">
<td></td>
<td>clearSaveBufState()</td>
</tr>
<tr class="even">
<td></td>
<td>cb(false)</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>})</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>function saveSaveGame(index, cb) {</td>
</tr>
<tr class="even">
<td></td>
<td>console.log('save', gameID, index)</td>
</tr>
<tr class="odd">
<td></td>
<td>tmpSaveBuf.set(wasmSaveBuf)</td>
</tr>
<tr class="even">
<td></td>
<td>localforage.setItem(gameID + '-save-' + index, tmpSaveBuf, function
(err, data) {</td>
</tr>
<tr class="odd">
<td></td>
<td>cb(true)</td>
</tr>
<tr class="even">
<td></td>
<td>})</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>function savBackupBtn() {</td>
</tr>
<tr class="even">
<td></td>
<td>var blob = new Blob([wasmSaveBuf], { type: "application/binary"
});</td>
</tr>
<tr class="odd">
<td></td>
<td>var link = document.createElement("a");</td>
</tr>
<tr class="even">
<td></td>
<td>link.href = window.URL.createObjectURL(blob);</td>
</tr>
<tr class="odd">
<td></td>
<td>link.download = 'save-' + gameID + '.44gbasav';</td>
</tr>
<tr class="even">
<td></td>
<td>link.click();</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>function savRestoreBtn() {</td>
</tr>
<tr class="even">
<td></td>
<td>var file = document.getElementById('sav-file').files[0]</td>
</tr>
<tr class="odd">
<td></td>
<td>if (file) {</td>
</tr>
<tr class="even">
<td></td>
<td>var fileReader = new FileReader()</td>
</tr>
<tr class="odd">
<td></td>
<td>fileReader.onload = function (event) {</td>
</tr>
<tr class="even">
<td></td>
<td>var arrayBuffer = event.target.result</td>
</tr>
<tr class="odd">
<td></td>
<td>var u8 = new Uint8Array(arrayBuffer)</td>
</tr>
<tr class="even">
<td></td>
<td>wasmSaveBuf.set(u8)</td>
</tr>
<tr class="odd">
<td></td>
<td>alert('sav file loaded')</td>
</tr>
<tr class="even">
<td></td>
<td>Module._resetCpu()</td>
</tr>
<tr class="odd">
<td></td>
<td>clearSaveBufState()</td>
</tr>
<tr class="even">
<td></td>
<td>};</td>
</tr>
<tr class="odd">
<td></td>
<td>fileReader.readAsArrayBuffer(file)</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>function loadRomArrayBuffer(arrayBuffer) {</td>
</tr>
<tr class="even">
<td></td>
<td>isRunning = false</td>
</tr>
<tr class="odd">
<td></td>
<td>console.log(arrayBuffer)</td>
</tr>
<tr class="even">
<td></td>
<td>var u8 = new Uint8Array(arrayBuffer)</td>
</tr>
<tr class="odd">
<td></td>
<td>gameID = ""</td>
</tr>
<tr class="even">
<td></td>
<td>if (u8[0xB2] != 0x96) {</td>
</tr>
<tr class="odd">
<td></td>
<td>alert('Not a valid GBA ROM!')</td>
</tr>
<tr class="even">
<td></td>
<td>return</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>for (var i = 0xAC; i &lt; 0xB2; i++) {</td>
</tr>
<tr class="odd">
<td></td>
<td>console.log(u8[i])</td>
</tr>
<tr class="even">
<td></td>
<td>gameID += String.fromCharCode(u8[i])</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>if ((u8[0xAC] == 0) || (gameID.substr(0, 4) == '0000')) {</td>
</tr>
<tr class="odd">
<td></td>
<td>// a homebrew! use file name as id</td>
</tr>
<tr class="even">
<td></td>
<td>gameID = romFileName</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>console.log('gameID', gameID)</td>
</tr>
<tr class="odd">
<td></td>
<td>Module.HEAPU8.set(u8, romBuffer)</td>
</tr>
<tr class="even">
<td></td>
<td>var ret = Module._loadRom(u8.length)</td>
</tr>
<tr class="odd">
<td></td>
<td>document.getElementById('welcome').hidden = true</td>
</tr>
<tr class="even">
<td></td>
<td>loadSaveGame(0, function () {</td>
</tr>
<tr class="odd">
<td></td>
<td>Module._resetCpu()</td>
</tr>
<tr class="even">
<td></td>
<td>isRunning = true</td>
</tr>
<tr class="odd">
<td></td>
<td>})</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>function onHomebrewListSelected() {</td>
</tr>
<tr class="even">
<td></td>
<td>if (!isWasmReady) {</td>
</tr>
<tr class="odd">
<td></td>
<td>alert('WASM not ready!')</td>
</tr>
<tr class="even">
<td></td>
<td>return</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>tryInitSound()</td>
</tr>
<tr class="odd">
<td></td>
<td>var fn = document.getElementById('homebrew-list').value</td>
</tr>
<tr class="even">
<td></td>
<td>if (fn == '') {</td>
</tr>
<tr class="odd">
<td></td>
<td>return</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>romFileName = fn</td>
</tr>
<tr class="even">
<td></td>
<td>document.getElementById('select-rom').innerText =
'Downloading...'</td>
</tr>
<tr class="odd">
<td></td>
<td>fetch('roms/' + fn + '.gba').then(function (resp) {</td>
</tr>
<tr class="even">
<td></td>
<td>resp.arrayBuffer().then(function (ab) {</td>
</tr>
<tr class="odd">
<td></td>
<td>loadRomArrayBuffer(ab)</td>
</tr>
<tr class="even">
<td></td>
<td>})</td>
</tr>
<tr class="odd">
<td></td>
<td>});</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>function onFileSelected() {</td>
</tr>
<tr class="odd">
<td></td>
<td>if (!isWasmReady) {</td>
</tr>
<tr class="even">
<td></td>
<td>alert('WASM not ready!')</td>
</tr>
<tr class="odd">
<td></td>
<td>return</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>tryInitSound()</td>
</tr>
<tr class="even">
<td></td>
<td>var file = fileInput.files[0]</td>
</tr>
<tr class="odd">
<td></td>
<td>if (file) {</td>
</tr>
<tr class="even">
<td></td>
<td>romFileName = file.name</td>
</tr>
<tr class="odd">
<td></td>
<td>var arrayBuffer</td>
</tr>
<tr class="even">
<td></td>
<td>var fileReader = new FileReader()</td>
</tr>
<tr class="odd">
<td></td>
<td>fileReader.onload = function (event) {</td>
</tr>
<tr class="even">
<td></td>
<td>var arrayBuffer = event.target.result</td>
</tr>
<tr class="odd">
<td></td>
<td>loadRomArrayBuffer(arrayBuffer)</td>
</tr>
<tr class="even">
<td></td>
<td>};</td>
</tr>
<tr class="odd">
<td></td>
<td>fileReader.readAsArrayBuffer(file)</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>function emuRunFrame() {</td>
</tr>
<tr class="even">
<td></td>
<td>if (isRunning) {</td>
</tr>
<tr class="odd">
<td></td>
<td>frameCnt++</td>
</tr>
<tr class="even">
<td></td>
<td>if (frameCnt % 60 == 0) {</td>
</tr>
<tr class="odd">
<td></td>
<td>checkSaveBufState()</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>if (frameCnt % 128 == 0) {</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>if (last128FrameTime) {</td>
</tr>
<tr class="even">
<td></td>
<td>var diff = performance.now() - last128FrameTime</td>
</tr>
<tr class="odd">
<td></td>
<td>var frameInMs = diff / 128</td>
</tr>
<tr class="even">
<td></td>
<td>var fps = -1</td>
</tr>
<tr class="odd">
<td></td>
<td>if (frameInMs &gt; 0.001) {</td>
</tr>
<tr class="even">
<td></td>
<td>fps = 1000 / frameInMs</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>console.log('fps', fps)</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>last128FrameTime = performance.now()</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>lastFrameTime = performance.now()</td>
</tr>
<tr class="even">
<td></td>
<td>Module._runFrame(getVKState());</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>function emuLoop() {</td>
</tr>
<tr class="even">
<td></td>
<td>window.requestAnimationFrame(emuLoop)</td>
</tr>
<tr class="odd">
<td></td>
<td>emuRunFrame()</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>emuLoop()</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>function initVK() {</td>
</tr>
<tr class="even">
<td></td>
<td>var vks = document.getElementsByClassName('vk')</td>
</tr>
<tr class="odd">
<td></td>
<td>for (var i = 0; i &lt; vks.length; i++) {</td>
</tr>
<tr class="even">
<td></td>
<td>var vk = vks[i]</td>
</tr>
<tr class="odd">
<td></td>
<td>var k = vks[i].getAttribute('data-k')</td>
</tr>
<tr class="even">
<td></td>
<td>keyState[k] = [vk, 0, 0]</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>initVK()</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>function makeVKStyle(top, left, w, h, fontSize) {</td>
</tr>
<tr class="even">
<td></td>
<td>return 'top:' + top + 'px;left:' + left + 'px;width:' + w +
'px;height:' + h + 'px;' + 'font-size:' + fontSize + 'px;line-height:' +
h + 'px;'</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>function adjustVKLayout() {</td>
</tr>
<tr class="odd">
<td></td>
<td>var isLandscape = window.innerWidth &gt; window.innerHeight</td>
</tr>
<tr class="even">
<td></td>
<td>var baseSize = Math.min(Math.min(window.innerWidth,
window.innerHeight) * 0.14, 50)</td>
</tr>
<tr class="odd">
<td></td>
<td>var fontSize = baseSize * 0.7</td>
</tr>
<tr class="even">
<td></td>
<td>var offTop = 0</td>
</tr>
<tr class="odd">
<td></td>
<td>var offLeft = 0</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>if (!isLandscape) {</td>
</tr>
<tr class="even">
<td></td>
<td>offTop = gbaHeight + baseSize</td>
</tr>
<tr class="odd">
<td></td>
<td>if ((offTop + baseSize * 7) &gt; window.innerHeight) {</td>
</tr>
<tr class="even">
<td></td>
<td>offTop = 0</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>var vkw = baseSize * 3</td>
</tr>
<tr class="odd">
<td></td>
<td>var vkh = baseSize</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>keyState['l'][0].style = makeVKStyle(offTop + baseSize * 1.5, 0,
vkw, vkh, fontSize)</td>
</tr>
<tr class="even">
<td></td>
<td>keyState['r'][0].style = makeVKStyle(offTop + baseSize * 1.5,
window.innerWidth - vkw, vkw, vkh, fontSize)</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>vkh = baseSize * 0.5</td>
</tr>
<tr class="odd">
<td></td>
<td>keyState['turbo'][0].style = makeVKStyle(offTop + baseSize * 0.5, 0,
vkw, vkh, fontSize)</td>
</tr>
<tr class="even">
<td></td>
<td>keyState['menu'][0].style = makeVKStyle(offTop + baseSize * 0.5,
window.innerWidth - vkw, vkw, vkh, fontSize)</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>vkh = baseSize</td>
</tr>
<tr class="odd">
<td></td>
<td>vkw = baseSize</td>
</tr>
<tr class="even">
<td></td>
<td>offTop += baseSize * 3</td>
</tr>
<tr class="odd">
<td></td>
<td>/*</td>
</tr>
<tr class="even">
<td></td>
<td>offLeft = isLandscape ? (baseSize * 1) : 0</td>
</tr>
<tr class="odd">
<td></td>
<td>if (baseSize * 6 &gt; window.innerWidth) {</td>
</tr>
<tr class="even">
<td></td>
<td>offLeft = 0</td>
</tr>
<tr class="odd">
<td></td>
<td>}*/</td>
</tr>
<tr class="even">
<td></td>
<td>offLeft = 0</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>keyState['up'][0].style = makeVKStyle(offTop, offLeft + vkw, vkw,
vkh, fontSize)</td>
</tr>
<tr class="odd">
<td></td>
<td>keyState['ul'][0].style = makeVKStyle(offTop, offLeft, vkw, vkh,
fontSize)</td>
</tr>
<tr class="even">
<td></td>
<td>keyState['ur'][0].style = makeVKStyle(offTop, offLeft + vkw * 2,
vkw, vkh, fontSize)</td>
</tr>
<tr class="odd">
<td></td>
<td>keyState['down'][0].style = makeVKStyle(offTop + vkh * 2, offLeft +
vkw, vkw, vkh, fontSize)</td>
</tr>
<tr class="even">
<td></td>
<td>keyState['dl'][0].style = makeVKStyle(offTop + vkh * 2, offLeft,
vkw, vkh, fontSize)</td>
</tr>
<tr class="odd">
<td></td>
<td>keyState['dr'][0].style = makeVKStyle(offTop + vkh * 2, offLeft +
vkw * 2, vkw, vkh, fontSize)</td>
</tr>
<tr class="even">
<td></td>
<td>keyState['left'][0].style = makeVKStyle(offTop + vkh, offLeft + 0,
vkw, vkh, fontSize)</td>
</tr>
<tr class="odd">
<td></td>
<td>keyState['right'][0].style = makeVKStyle(offTop + vkh, offLeft + vkw
* 2, vkw, vkh, fontSize)</td>
</tr>
<tr class="even">
<td></td>
<td>abSize = vkw * 1.3</td>
</tr>
<tr class="odd">
<td></td>
<td>keyState['a'][0].style = makeVKStyle(offTop + vkh - baseSize * 0.5,
window.innerWidth - abSize, abSize, abSize, fontSize)</td>
</tr>
<tr class="even">
<td></td>
<td>keyState['b'][0].style = makeVKStyle(offTop + vkh, window.innerWidth
- abSize * 2.4, abSize, abSize, fontSize)</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>vkh = baseSize * 0.5</td>
</tr>
<tr class="odd">
<td></td>
<td>vkw = baseSize * 3</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>offLeft = (window.innerWidth - vkw * 2.2) / 2</td>
</tr>
<tr class="even">
<td></td>
<td>offTop += baseSize * 3 + baseSize * 0.5</td>
</tr>
<tr class="odd">
<td></td>
<td>if (isLandscape) {</td>
</tr>
<tr class="even">
<td></td>
<td>offTop = window.innerHeight - vkh</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>keyState['select'][0].style = makeVKStyle(offTop, offLeft , vkw,
vkh, fontSize)</td>
</tr>
<tr class="even">
<td></td>
<td>keyState['start'][0].style = makeVKStyle(offTop, offLeft + vkw * 1.2
, vkw, vkh, fontSize)</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>function adjustSize() {</td>
</tr>
<tr class="even">
<td></td>
<td>var gbaMaxWidth = window.innerWidth</td>
</tr>
<tr class="odd">
<td></td>
<td>var gbaMaxHeight = window.innerHeight - 20</td>
</tr>
<tr class="even">
<td></td>
<td>var l = 0</td>
</tr>
<tr class="odd">
<td></td>
<td>var w = gbaMaxWidth</td>
</tr>
<tr class="even">
<td></td>
<td>var h = w / 240 * 160</td>
</tr>
<tr class="odd">
<td></td>
<td>if (h &gt; gbaMaxHeight) {</td>
</tr>
<tr class="even">
<td></td>
<td>h = gbaMaxHeight</td>
</tr>
<tr class="odd">
<td></td>
<td>w = h / 160 * 240</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>var scaleFator = (w / 240) // | 0</td>
</tr>
<tr class="even">
<td></td>
<td>gbaWidth = 240 * scaleFator</td>
</tr>
<tr class="odd">
<td></td>
<td>gbaHeight = 160 * scaleFator</td>
</tr>
<tr class="even">
<td></td>
<td>l += (window.innerWidth - gbaWidth) / 2;</td>
</tr>
<tr class="odd">
<td></td>
<td>canvas.style = 'width:' + gbaWidth + 'px;height:' + gbaHeight +
'px;left:' + l + 'px;'</td>
</tr>
<tr class="even">
<td></td>
<td>adjustVKLayout()</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>window.onresize = adjustSize</td>
</tr>
<tr class="even">
<td></td>
<td>window.onorientationchange = adjustSize</td>
</tr>
<tr class="odd">
<td></td>
<td>adjustSize()</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>function handleTouch(event) {</td>
</tr>
<tr class="odd">
<td></td>
<td>tryInitSound()</td>
</tr>
<tr class="even">
<td></td>
<td>if (!isRunning) {</td>
</tr>
<tr class="odd">
<td></td>
<td>return</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>event.preventDefault();</td>
</tr>
<tr class="even">
<td></td>
<td>event.stopPropagation();</td>
</tr>
<tr class="odd">
<td></td>
<td>document.getElementById('vk-layer').hidden = false</td>
</tr>
<tr class="even">
<td></td>
<td>for (var k in keyState) {</td>
</tr>
<tr class="odd">
<td></td>
<td>keyState[k][2] = 0</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>for (var i = 0; i &lt; event.touches.length; i++) {</td>
</tr>
<tr class="even">
<td></td>
<td>var t = event.touches[i];</td>
</tr>
<tr class="odd">
<td></td>
<td>var dom = document.elementFromPoint(t.clientX, t.clientY)</td>
</tr>
<tr class="even">
<td></td>
<td>if (dom) {</td>
</tr>
<tr class="odd">
<td></td>
<td>var k = dom.getAttribute('data-k')</td>
</tr>
<tr class="even">
<td></td>
<td>if (k) {</td>
</tr>
<tr class="odd">
<td></td>
<td>keyState[k][2] = 1</td>
</tr>
<tr class="even">
<td></td>
<td>if (k == 'ul') {</td>
</tr>
<tr class="odd">
<td></td>
<td>keyState['up'][2] = 1</td>
</tr>
<tr class="even">
<td></td>
<td>keyState['left'][2] = 1</td>
</tr>
<tr class="odd">
<td></td>
<td>} else if (k == 'ur') {</td>
</tr>
<tr class="even">
<td></td>
<td>keyState['up'][2] = 1</td>
</tr>
<tr class="odd">
<td></td>
<td>keyState['right'][2] = 1</td>
</tr>
<tr class="even">
<td></td>
<td>} else if (k == 'dl') {</td>
</tr>
<tr class="odd">
<td></td>
<td>keyState['down'][2] = 1</td>
</tr>
<tr class="even">
<td></td>
<td>keyState['left'][2] = 1</td>
</tr>
<tr class="odd">
<td></td>
<td>} else if (k == 'dr') {</td>
</tr>
<tr class="even">
<td></td>
<td>keyState['down'][2] = 1</td>
</tr>
<tr class="odd">
<td></td>
<td>keyState['right'][2] = 1</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>if (keyState['menu'][2]) {</td>
</tr>
<tr class="odd">
<td></td>
<td>setPauseMenu(true)</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>if (keyState['turbo'][2] != keyState['turbo'][1]) {</td>
</tr>
<tr class="even">
<td></td>
<td>setTurboMode(keyState['turbo'][2])</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>for (var k in keyState) {</td>
</tr>
<tr class="odd">
<td></td>
<td>if (keyState[k][1] != keyState[k][2]) {</td>
</tr>
<tr class="even">
<td></td>
<td>var dom = keyState[k][0]</td>
</tr>
<tr class="odd">
<td></td>
<td>keyState[k][1] = keyState[k][2]</td>
</tr>
<tr class="even">
<td></td>
<td>if (keyState[k][1]) {</td>
</tr>
<tr class="odd">
<td></td>
<td>dom.classList.add('vk-touched')</td>
</tr>
<tr class="even">
<td></td>
<td>} else {</td>
</tr>
<tr class="odd">
<td></td>
<td>dom.classList.remove('vk-touched')</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>/*</td>
</tr>
<tr class="even">
<td></td>
<td>// dunno why, but we should do that first on iOS</td>
</tr>
<tr class="odd">
<td></td>
<td>window.ontouchstart = function() {</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>};</td>
</tr>
<tr class="even">
<td></td>
<td>window.ontouchstart = handleTouch;</td>
</tr>
<tr class="odd">
<td></td>
<td>window.ontouchmove = handleTouch;</td>
</tr>
<tr class="even">
<td></td>
<td>window.ontouchcancel = handleTouch;</td>
</tr>
<tr class="odd">
<td></td>
<td>window.ontouchend = handleTouch;*/</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>//'touchcancel', , 'touchforcechange'</td>
</tr>
<tr class="even">
<td></td>
<td>['touchstart', 'touchmove', 'touchend', 'touchcancel', 'touchenter',
'touchleave'].forEach((val) =&gt; {</td>
</tr>
<tr class="odd">
<td></td>
<td>window.addEventListener(val, handleTouch)</td>
</tr>
<tr class="even">
<td></td>
<td>})</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>document.getElementById('vk-layer').ontouchstart = (e) =&gt; {</td>
</tr>
<tr class="odd">
<td></td>
<td>e.preventDefault()</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>function getVKState() {</td>
</tr>
<tr class="odd">
<td></td>
<td>var ret = 0;</td>
</tr>
<tr class="even">
<td></td>
<td>for (var i = 0; i &lt; 10; i++) {</td>
</tr>
<tr class="odd">
<td></td>
<td>ret = ret | (keyState[keyList[i]][1] &lt;&lt; i);</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>return ret;</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>function convertKeyCode(keyCode) {</td>
</tr>
<tr class="odd">
<td></td>
<td>const keymap = [90, 88, 8, 13, 39, 37, 38, 40, 17, 16]</td>
</tr>
<tr class="even">
<td></td>
<td>//8bitdo Zero2 in Keyboard Mode</td>
</tr>
<tr class="odd">
<td></td>
<td>const keymap2 = [71, 74, 78, 79, 70, 69, 67, 68, 77, 75]</td>
</tr>
<tr class="even">
<td></td>
<td>for (var i = 0; i &lt; 10; i++) {</td>
</tr>
<tr class="odd">
<td></td>
<td>if (keyCode == keymap[i]) {</td>
</tr>
<tr class="even">
<td></td>
<td>return i</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>if (keyCode == keymap2[i]) {</td>
</tr>
<tr class="odd">
<td></td>
<td>return i</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>return -1</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>document.onkeydown = function (e) {</td>
</tr>
<tr class="even">
<td></td>
<td>tryInitSound()</td>
</tr>
<tr class="odd">
<td></td>
<td>console.log(e.keyCode)</td>
</tr>
<tr class="even">
<td></td>
<td>if (!isRunning) {</td>
</tr>
<tr class="odd">
<td></td>
<td>return</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>e.preventDefault()</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>var k = convertKeyCode(e.keyCode)</td>
</tr>
<tr class="even">
<td></td>
<td>if (k &gt;= 0) {</td>
</tr>
<tr class="odd">
<td></td>
<td>keyState[keyList[k]][1] = 1</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>document.onkeyup = function (e) {</td>
</tr>
<tr class="even">
<td></td>
<td>if (!isRunning) {</td>
</tr>
<tr class="odd">
<td></td>
<td>return</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>e.preventDefault()</td>
</tr>
<tr class="even">
<td></td>
<td>var k = convertKeyCode(e.keyCode)</td>
</tr>
<tr class="odd">
<td></td>
<td>if (k &gt;= 0) {</td>
</tr>
<tr class="even">
<td></td>
<td>keyState[keyList[k]][1] = 0</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>if (e.keyCode == 27) {</td>
</tr>
<tr class="odd">
<td></td>
<td>setPauseMenu(true)</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>function checkSaveBufState() {</td>
</tr>
<tr class="even">
<td></td>
<td>if (!isRunning) {</td>
</tr>
<tr class="odd">
<td></td>
<td>return;</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>var state = Module._updateSaveBufState()</td>
</tr>
<tr class="even">
<td></td>
<td>//console.log(state)</td>
</tr>
<tr class="odd">
<td></td>
<td>if ((lastCheckedSaveState == 1) &amp;&amp; (state == 0) &amp;&amp;
(isSaveSupported)) {</td>
</tr>
<tr class="even">
<td></td>
<td>showMsg('Auto saving, please wait...')</td>
</tr>
<tr class="odd">
<td></td>
<td>saveSaveGame(0, function () {</td>
</tr>
<tr class="even">
<td></td>
<td>console.log('save done')</td>
</tr>
<tr class="odd">
<td></td>
<td>})</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>lastCheckedSaveState = state</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>function clearSaveBufState() {</td>
</tr>
<tr class="odd">
<td></td>
<td>lastCheckedSaveState = 0</td>
</tr>
<tr class="even">
<td></td>
<td>Module._updateSaveBufState()</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>function showMsg(msg) {</td>
</tr>
<tr class="odd">
<td></td>
<td>document.getElementById('msg-text').innerText = msg</td>
</tr>
<tr class="even">
<td></td>
<td>document.getElementById('msg-layer').hidden = false</td>
</tr>
<tr class="odd">
<td></td>
<td>setTimeout(function () {</td>
</tr>
<tr class="even">
<td></td>
<td>document.getElementById('msg-layer').hidden = true</td>
</tr>
<tr class="odd">
<td></td>
<td>}, 1000)</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>function setTurboMode(t) {</td>
</tr>
<tr class="odd">
<td></td>
<td>t = t ? true : false</td>
</tr>
<tr class="even">
<td></td>
<td>if (turboMode == t) {</td>
</tr>
<tr class="odd">
<td></td>
<td>return</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>if (t) {</td>
</tr>
<tr class="even">
<td></td>
<td>turboInterval = setInterval(emuRunFrame, 2)</td>
</tr>
<tr class="odd">
<td></td>
<td>} else {</td>
</tr>
<tr class="even">
<td></td>
<td>clearInterval(turboInterval)</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>turboMode = t</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>function setPauseMenu(t) {</td>
</tr>
<tr class="even">
<td></td>
<td>t = t ? true : false</td>
</tr>
<tr class="odd">
<td></td>
<td>isRunning = !t</td>
</tr>
<tr class="even">
<td></td>
<td>document.getElementById('pause-menu').hidden = !t</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>localforage.ready().then(function () { }).catch(function (err)
{</td>
</tr>
<tr class="even">
<td></td>
<td>alert('Save storage not supported: ' + err);</td>
</tr>
<tr class="odd">
<td></td>
<td>})</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>function chtWriteBtn() {</td>
</tr>
<tr class="even">
<td></td>
<td>var addr = parseInt(document.getElementById('cht-addr').value)</td>
</tr>
<tr class="odd">
<td></td>
<td>if (!addr) {</td>
</tr>
<tr class="even">
<td></td>
<td>alert('Invalid addr'); return</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td>Module._writeU32(addr,</td>
</tr>
<tr class="odd">
<td></td>
<td>parseInt(document.getElementById('cht-value').value))</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>function chtReadBtn() {</td>
</tr>
<tr class="odd">
<td></td>
<td>var addr = parseInt(document.getElementById('cht-addr').value)</td>
</tr>
<tr class="even">
<td></td>
<td>if (!addr) {</td>
</tr>
<tr class="odd">
<td></td>
<td>alert('Invalid addr'); return</td>
</tr>
<tr class="even">
<td></td>
<td>}</td>
</tr>
<tr class="odd">
<td></td>
<td>var val = Module._readU32(addr) &gt;&gt;&gt; 0</td>
</tr>
<tr class="even">
<td></td>
<td>document.getElementById('cht-value').value = '0x' +
val.toString(16)</td>
</tr>
<tr class="odd">
<td></td>
<td>}</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>window.addEventListener("gamepadconnected", function (e) {</td>
</tr>
<tr class="even">
<td></td>
<td>console.log("Gamepad connected")</td>
</tr>
<tr class="odd">
<td></td>
<td>});</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;/script&gt;</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>&lt;script src="<a
href="https://44670.org/gba/a.out.js"><u>a.out.js</u></a>"&gt;&lt;/script&gt;</td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;script src="<a
href="https://44670.org/sw-loader.js"><u>/sw-loader.js</u></a>"&gt;&lt;/script&gt;</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;/body&gt;</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>&lt;/html&gt;</td>
</tr>
</tbody>
</table>
</body>
</html>
